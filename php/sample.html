<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title></title>
  <meta name="viewport" content="initial-scale=1.0">
</head>
<body>
  
</body>
<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>

<button onclick="scan()">scan二维码</button>
<button onclick="photo()">照片</button>

<script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>

<script>
  
  $.ajax({
    url:'http://www.txyxin.online/token/php/getsign.php',
    method:'POST',
    data: {
      url: window.location.href
    },
    dataType:'json'
  }).done(function(res){
    console.log(res);   //对象
    //配置
      wx.config({
      debug: true,
      appId: res.appId,
      timestamp: res.timestamp,
      nonceStr: res.nonceStr,
      signature: res.signature,
      jsApiList: [
        'chooseImage','scanQRCode'
      ]
    });
  })


  function photo(){
    wx.chooseImage({
      count: 1, // 默认9
      sizeType: ['original', 'compressed'], // 可以指定是原图还是压缩图，默认二者都有
      sourceType: ['album', 'camera'], // 可以指定来源是相册还是相机，默认二者都有
      success: function (res) {
          var localIds = res.localIds; // 返回选定照片的本地ID列表，localId可以作为img标签的src属性显示图片
      }
  });
  }

   function scan(){
    wx.scanQRCode({
        needResult: 0, // 默认为0，扫描结果由微信处理，1则直接返回扫描结果，
        scanType: ["qrCode","barCode"], // 可以指定扫二维码还是一维码，默认二者都有
        success: function (res) {
        var result = res.resultStr; // 当needResult 为 1 时，扫码返回的结果
        alert(result);
    }
    });
  }
</script>
</html>
